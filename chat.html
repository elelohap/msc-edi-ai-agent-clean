<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Chat</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    #chat-box { width: 100%; height: 300px; border: 1px solid #ccc; padding: 10px; overflow-y: auto; }
  </style>
</head>
<body>

<h2>Chatbot</h2>

<div id="chat-box"></div>

<br>

<input id="question" type="text" placeholder="Ask something..." style="width:80%;" />
<button onclick="send()">Send</button>

<script>
async function send() {
    const question = document.getElementById("question").value;

    document.getElementById("chat-box").innerHTML += `<p><b>You:</b> ${question}</p>`;

    try {
        const response = await fetch("/ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
        });

        let text = await response.text(); // Try reading raw text

let data;
try {
    data = JSON.parse(text); // Attempt JSON parse
} catch {
    document.getElementById("chat-box").innerHTML += `<p><b>Server Error:</b><br>${text}</p>`;
    return;
}


        if (data.answer)
            document.getElementById("chat-box").innerHTML += `<p><b>AI:</b> ${data.answer}</p>`;
        else
            document.getElementById("chat-box").innerHTML += `<p><b>Error:</b> ${JSON.stringify(data)}</p>`;

    } catch (err) {
        document.getElementById("chat-box").innerHTML += `<p><b>Error:</b> ${err}</p>`;
    }
}
</script>

</body>
</html>
